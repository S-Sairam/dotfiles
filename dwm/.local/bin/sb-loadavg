#!/bin/sh

# Handle Clicks
case $BLOCK_BUTTON in
	1) notify-send "CPU Hogs" "$(ps -eo pcpu,comm --sort=-%cpu | head -n 11)" ;;
	3) setsid -f "$TERMINAL" -e htop ;;
esac

# Calculate CPU Usage
# 1. Read /proc/stat (first line is total cpu)
read cpu a b c idle rest < /proc/stat
prev_total=$((a+b+c+idle))
prev_idle=$idle

# 2. Wait a tiny bit (0.1s) to measure activity
sleep 0.1

# 3. Read again
read cpu a b c idle rest < /proc/stat
total=$((a+b+c+idle))

# 4. Calculate the difference (delta)
cpu_delta=$((total - prev_total))
idle_delta=$((idle - prev_idle))
used_delta=$((cpu_delta - idle_delta))

# 5. Math: (Used / Total) * 100
# We use integer math (multiply by 100 first)
cpu_usage=$(( (used_delta * 100) / cpu_delta ))

# Output
echo " $cpu_usage%"
